<?xml version="1.0" encoding="utf-8"?>
<navigation xmlns:android="http://schemas.android.com/apk/res/android"
    xmlns:app="http://schemas.android.com/apk/res-auto"
    xmlns:tools="http://schemas.android.com/tools"
    android:id="@+id/nav_graph"
    app:startDestination="@id/homeFragment">

    <!-- 全局 Action -->
    <action android:id="@+id/action_global_developerSettingsFragment"
        app:destination="@id/developerSettingsFragment"/>
    <action android:id="@+id/action_global_deepDeveloperFragment"
        app:destination="@id/deepDeveloperFragment"/>
    <action
        android:id="@+id/action_global_permissionsFragment"
        app:destination="@id/permissionsFragment" />
    <action
        android:id="@+id/action_global_logReaderFragment"
        app:destination="@id/logReaderFragment" />

    <!-- Home -->
    <fragment
        android:id="@+id/homeFragment"
        android:name="com.errorsiayusulif.zakocountdown.ui.home.HomeFragment"
        android:label="ZakoCountdown"
        tools:layout="@layout/fragment_home">
        <action
            android:id="@+id/action_homeFragment_to_addEditEventFragment"
            app:destination="@id/addEditEventFragment" />
        <action
            android:id="@+id/action_homeFragment_to_cardSettingsFragment"
            app:destination="@id/cardSettingsFragment" />
        <!-- 新增：跳转到分享预览 -->
        <action
            android:id="@+id/action_homeFragment_to_sharePreviewFragment"
            app:destination="@id/sharePreviewFragment" />
    </fragment>

    <!-- Add/Edit Event -->
    <fragment
        android:id="@+id/addEditEventFragment"
        android:name="com.errorsiayusulif.zakocountdown.ui.addedit.AddEditEventFragment"
        android:label="{title}"
        tools:layout="@layout/fragment_add_edit_event">
        <argument android:name="eventId" app:argType="long" android:defaultValue="-1L" />
        <argument android:name="title" app:argType="string" android:defaultValue="添加日程" />
        <!-- 新增：默认归属的日程本ID -->
        <argument android:name="defaultBookId" app:argType="long" android:defaultValue="-1L" />
    </fragment>

    <!-- Settings -->
    <fragment
        android:id="@+id/settingsFragment"
        android:name="com.errorsiayusulif.zakocountdown.ui.settings.SettingsFragment"
        android:label="设置">
        <action
            android:id="@+id/action_settingsFragment_to_developerSettingsFragment"
            app:destination="@id/developerSettingsFragment" />
        <action
            android:id="@+id/action_settingsFragment_to_appSelectorFragment"
            app:destination="@id/appSelectorFragment" />
        <action
            android:id="@+id/action_settingsFragment_to_aboutFragment"
            app:destination="@id/aboutFragment" />
        <action
            android:id="@+id/action_settingsFragment_to_notificationSettingsFragment"
            app:destination="@id/notificationSettingsFragment" />
        <action
            android:id="@+id/action_settingsFragment_to_permissionsFragment"
            app:destination="@id/permissionsFragment" />
        <action
            android:id="@+id/action_settingsFragment_to_advancedSettingsFragment"
            app:destination="@id/advancedSettingsFragment" />
        <action
            android:id="@+id/action_settingsFragment_to_personalizationFragment"
            app:destination="@id/personalizationFragment" />
    </fragment>

    <!-- Sub-settings & Features -->
    <fragment
        android:id="@+id/aboutFragment"
        android:name="com.errorsiayusulif.zakocountdown.ui.settings.AboutFragment"
        android:label="关于"
        tools:layout="@layout/fragment_about">
        <action
            android:id="@+id/action_aboutFragment_to_buildDetailsFragment"
            app:destination="@id/buildDetailsFragment" />
        <action
            android:id="@+id/action_aboutFragment_to_licenseFragment"
            app:destination="@id/licenseFragment" />
    </fragment>

    <fragment
        android:id="@+id/buildDetailsFragment"
        android:name="com.errorsiayusulif.zakocountdown.ui.settings.BuildDetailsFragment"
        android:label="详细信息" />

    <fragment
        android:id="@+id/licenseFragment"
        android:name="com.errorsiayusulif.zakocountdown.ui.settings.LicenseFragment"
        android:label="许可证"
        tools:layout="@layout/fragment_license" />

    <fragment
        android:id="@+id/cardSettingsFragment"
        android:name="com.errorsiayusulif.zakocountdown.ui.settings.CardSettingsFragment"
        android:label="卡片个性化" >
        <argument android:name="eventId" app:argType="long" />
    </fragment>

    <fragment
        android:id="@+id/appSelectorFragment"
        android:name="com.errorsiayusulif.zakocountdown.ui.settings.AppSelectorFragment"
        android:label="选择应用" />

    <fragment
        android:id="@+id/developerSettingsFragment"
        android:name="com.errorsiayusulif.zakocountdown.ui.settings.DeveloperSettingsFragment"
        android:label="开发者选项" />

    <fragment
        android:id="@+id/notificationSettingsFragment"
        android:name="com.errorsiayusulif.zakocountdown.ui.settings.NotificationSettingsFragment"
        android:label="通知设置">
        <deepLink
            app:uri="errorsiayusulif://zakocountdown/notifications"
            android:autoVerify="true"/>
    </fragment>

    <fragment
        android:id="@+id/permissionsFragment"
        android:name="com.errorsiayusulif.zakocountdown.ui.settings.PermissionsFragment"
        android:label="权限中心" />

    <fragment
        android:id="@+id/advancedSettingsFragment"
        android:name="com.errorsiayusulif.zakocountdown.ui.settings.AdvancedSettingsFragment"
        android:label="高级功能">
        <action
            android:id="@+id/action_advancedSettingsFragment_to_appSelectorFragment"
            app:destination="@id/appSelectorFragment" />
    </fragment>

    <fragment
        android:id="@+id/personalizationFragment"
        android:name="com.errorsiayusulif.zakocountdown.ui.settings.PersonalizationFragment"
        android:label="个性化" />

    <fragment
        android:id="@+id/deepDeveloperFragment"
        android:name="com.errorsiayusulif.zakocountdown.ui.settings.DeepDeveloperFragment"
        android:label="深层开发者选项">
        <action
            android:id="@+id/action_deepDeveloperFragment_to_logReaderFragment"
            app:destination="@id/logReaderFragment" />
        <action
            android:id="@+id/action_deepDeveloperFragment_to_logFileListFragment"
            app:destination="@id/logFileListFragment" />
    </fragment>

    <fragment
        android:id="@+id/logReaderFragment"
        android:name="com.errorsiayusulif.zakocountdown.ui.settings.LogReaderFragment"
        android:label="日志详情">
        <argument
            android:name="filePath"
            app:argType="string"
            app:nullable="true"
            android:defaultValue="@null" />
    </fragment>

    <fragment
        android:id="@+id/logFileListFragment"
        android:name="com.errorsiayusulif.zakocountdown.ui.settings.LogFileListFragment"
        android:label="历史日志文件">
        <action
            android:id="@+id/action_logFileListFragment_to_logReaderFragment"
            app:destination="@id/logReaderFragment" />
    </fragment>

    <!-- 分享预览 -->
    <fragment
        android:id="@+id/sharePreviewFragment"
        android:name="com.errorsiayusulif.zakocountdown.ui.share.SharePreviewFragment"
        android:label="生成分享卡片">
        <argument
            android:name="eventId"
            app:argType="long" />
    </fragment>

    <!-- ============================================= -->
    <!-- =====      日程本 (Agenda Book) 系统     ===== -->
    <!-- ============================================= -->

    <!-- 1. 日程本列表 (管理页) -->
    <fragment
        android:id="@+id/agendaBookFragment"
        android:name="com.errorsiayusulif.zakocountdown.ui.agenda.AgendaBookFragment"
        android:label="日程本">
        <action
            android:id="@+id/action_agendaBookFragment_to_addEditAgendaBookFragment"
            app:destination="@id/addEditAgendaBookFragment" />
        <action
            android:id="@+id/action_agendaBookFragment_to_agendaDetailFragment"
            app:destination="@id/agendaDetailFragment" />
    </fragment>

    <!-- 2. 日程本详情页 (列表与统计) -->
    <fragment
        android:id="@+id/agendaDetailFragment"
        android:name="com.errorsiayusulif.zakocountdown.ui.agenda.AgendaDetailFragment"
        android:label="日程本详情">
        <argument
            android:name="bookId"
            app:argType="long" />
        <action
            android:id="@+id/action_agendaDetailFragment_to_addEditEventFragment"
            app:destination="@id/addEditEventFragment" />
        <action
            android:id="@+id/action_agendaDetailFragment_to_addEditAgendaBookFragment"
            app:destination="@id/addEditAgendaBookFragment" />
        <action
            android:id="@+id/action_agendaDetailFragment_to_cardSettingsFragment"
            app:destination="@id/cardSettingsFragment" />
    </fragment>

    <!-- 3. 日程本编辑/新建页 -->
    <fragment
        android:id="@+id/addEditAgendaBookFragment"
        android:name="com.errorsiayusulif.zakocountdown.ui.agenda.AddEditAgendaBookFragment"
        android:label="{title}">
        <!-- 默认 -1L 表示新建，其他表示编辑 -->
        <argument
            android:name="bookId"
            app:argType="long"
            android:defaultValue="-1L" />
        <argument
            android:name="title"
            app:argType="string"
            android:defaultValue="新建日程本" />
    </fragment>
    <!-- 数据备份与迁移页 -->
    <fragment
        android:id="@+id/backupRestoreFragment"
        android:name="com.errorsiayusulif.zakocountdown.ui.settings.BackupRestoreFragment"
        android:label="数据备份与迁移" />
</navigation>